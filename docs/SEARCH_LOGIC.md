# 지역 검색 로직 문서화 (Search Logic Documentation)

## 1. 개요 (Overview)

이 모듈은 사용자 입력(초성, 완성형, 혼합형)에 대해 약 2만 개의 행정구역 데이터(`korea_districts.json`)를 검색하고, 연관성 높은 순서로 정렬하여 반환합니다.

## 2. 핵심 알고리즘: `koreanIncludes`

### 동작 원리
대상 문자열(`target`)을 순회하며 검색어(`query`) 길이만큼의 윈도우를 비교합니다. 각 문자는 다음 로직에 따라 비교됩니다:

1.  **초성 매칭 (`Choseong Matching`)**:
    *   검색어 문자가 자음(초성)인 경우 (`canBeChoseong`):
    *   대상 문자의 초성만 추출(`getChoseong`)하여 비교합니다.
    *   예: 검색어 'ㅅ' == 대상 '서' (일치)

2.  **부분 음절 매칭 (`Partial Syllable Matching`)**:
    *   검색어의 **마지막 글자**가 받침이 없는 완성형일 때 (예: '부사'):
    *   대상 문자를 분해(`disassembleCompleteCharacter`)하여 초성+중성까지만 일치하는지 확인합니다.
    *   목적: 사용자가 '부산'을 입력하려고 '부사'까지 쳤을 때도 매칭되게 함.

3.  **정확 매칭 (`Exact Matching`)**:
    *   위의 경우가 아니면 문자가 정확히 일치하는지 비교합니다.

## 3. 검색 전략: `matchDistrict`

단일 행정구역(`District`) 객체가 검색어와 매칭되는지 판단하고, 매칭 정보를 생성합니다.

### 3.1 토큰화 및 복합 쿼리
입력된 검색어는 공백을 기준으로 **토큰(Token)**으로 분리됩니다.
*   예: `"경기도 군포"` -> `["경기도", "군포"]`

### 3.2 매칭 로직
*   **복합 쿼리**: 모든 토큰이 각각 행정구역의 어딘가(시, 구, 동, 리)에 포함되어야 합니다. (AND 조건)
*   **연속 입력 처리**: 공백 없이 입력된 경우(예: `"경상북도의성군"`), 필드값을 이어 붙인(`concatenated`) 문자열에서 검색을 수행합니다.

### 3.3 매칭 메타데이터 생성
매칭 성공 시 다음 정보를 `LocationSearchResult` 객체에 담습니다:
*   `matchType`: 어느 레벨에서 매칭되었는지 (city > district > dong > li). 가장 구체적인 레벨을 우선합니다.
*   `matchIndex`: 검색어가 대상 문자열의 몇 번째 인덱스에서 시작하는지 (정렬 시 사용).
*   `isExactMatch`: 검색어와 대상이 완전히 일치하는지 여부.

## 4. 정렬 시스템: `sortResults`

검색 결과는 다음 **4단계 우선순위**에 따라 정렬됩니다. 이를 통해 사용자가 의도할 확률이 높은 결과를 상단에 노출합니다.

1.  **매칭 위치 (Match Index)**
    *   단어의 앞부분에 매칭될수록 우선순위가 높습니다.
    *   예: "**남**해군" (0) > "하**남**시" (1)

2.  **행정 계층 (Hierarchy Level)**
    *   상위 행정구역이 하위 행정구역보다 우선합니다.
    *   순서: 시/도(`city`) > 시/군/구(`district`) > 읍/면/동(`dong`) > 리(`li`)
    *   예: "**성남**시"(City) > "종로구 **성남**동"(Dong)

3.  **정확도 (Exact Match)**
    *   입력값과 필드값이 완전히 일치하는 경우 우선합니다.

4.  **가나다순 (Lexicographical Order)**
    *   위 조건이 모두 동일한 경우, 전체 주소(`full`)의 가나다순으로 정렬합니다.

## 5. 의존성 (Dependencies)
*   **`es-hangul`**: 한글 분해/조합, 초성 추출, 자음 판별 등 언어 처리를 위한 유틸리티 라이브러리.

